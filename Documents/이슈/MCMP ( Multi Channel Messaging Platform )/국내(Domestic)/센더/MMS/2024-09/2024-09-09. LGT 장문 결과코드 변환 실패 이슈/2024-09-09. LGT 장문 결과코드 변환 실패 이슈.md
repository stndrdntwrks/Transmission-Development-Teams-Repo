---
문서 타입: 이슈
프로세스 명: 직연동 MMS 센더
작성자: 심정훈
작성일: 2024-09-09
tags:
  - 결과코드변환실패
  - 해결
---




# 목차

1. [[#배경]]
2. [[#문제 파악 및 해결]]


---


# 배경

2024년 9월 5일 **MCMP 신규 211 대역 이전 작업 이후** 직연동 MMS 센더의 알맞는 버전의 결과코드 컨버전이 적용되지 않아 엘지 이동통신사의 리포트로 받은 **결과코드를 변환**하는 것에 **실패**하는 일이 생겼고, 리포터에서 읽어가는 결과코드 컨버전 파일을 수정하기 전까지 **엘지 이동통신사로 전송된 메세지 모든 건들**이 **결과 코드 변환에 실패하여 `RESULT_CODE` 값이 `2020` 으로 변환되어 적재**되게 되었다.

# 문제 파악 및 해결

엘지 메세지 건들에 코드 컨버전이 적용되지 않아 리포트가 잘못 전송된 문제를 해결하기 위하여 해당 메세지 건들의 리포트를 재전송해야하였다. 이를 위해 리포터에 알맞은 버전의 코드 컨버전을 적용한 후, 당일 발송된 메세지 건들을 데이터베이스에서 조회하여 다시 리포트 큐에 적재하여 리포트를 재전송할 수 있도록 `data-migrationer` 를 개발하였으며 리포트를 재전송하는 과정은 아래와 같다.

- 문제 해결 순서
	1. `data-migrationer` 를 배포
	2. `data-migrationer` 서버에 재전송 메세지를 csv 파일 적재 
	3. URL : `/re-send/t/mms-report`, METHOD : POST 방식으로 요청 본문에 csv 파일 위치를 작성하여 요청
	4. 요청 본문에 파일 위치에 있는 csv 파일을 읽어 `MessageDelivery` 값 할당하여 리포트 큐에 적재
	5. 리포터가 리포트 큐에 적재된 메세지를 가져와 리포트를 재전송
	6. 고객사 에이전트가 바라보는 테이블과 이력 DB 및 정산 DB 에도 해당 메세지 건에 대한 결과 코드 업데이트


### 해결 순서

- [x] 1. G_M_LG01 센더 프로세스 종료
- [x] 2. 데이터 베이스에서 해당 메세지건 조회
- [x] 3. 코드 컨버전 적용
- [x] 4. 리포터 재기동
- [x] 5. 데이터 마이그레이셔너에 POST 요청
- [x] 6. 리포터 로그 모니터링
- [x] 7. G_M_LG01 센더 프로세스 기동
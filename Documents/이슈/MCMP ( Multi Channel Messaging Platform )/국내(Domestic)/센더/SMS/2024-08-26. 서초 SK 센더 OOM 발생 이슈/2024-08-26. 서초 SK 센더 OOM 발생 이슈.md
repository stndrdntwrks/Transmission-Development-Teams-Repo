---
문서 타입:
  - 이슈
프로세스 명: SMS 센더
작성자: 심정훈
작성일: 2024-08-26
tags:
  - OOM
  - 해결
---

# 목차

1. [[#배경]]
2. [[#장애 조치]]
3. [[#해당 케이스 장애 해결 방안]]

---
# 배경

> 발생 시간 : *2024년 8월 25일 11시 58분*
> 문제 확인 시간 : *2024년 8월 26일 11시 10분 경*
> 
>  **서초(210.219.174.144) 의 SMS SK 센더(S_S_SK07, S_S_SK08, S_S_SK09, S_S_SK10)** 에서 OOM(Out Of Memory) 발생하여 각 센더의 RabbitMQ Consumer 가 죽어있는 것을 *2024-08-26 11시 10분 발견*

- 로그 일부 발췌 / `zgrep 'OutOf' S_S_SK08.2024-08-2* | less`
	```log
	S_S_SK08.2024-08-25_0.gz:java.lang.OutOfMemoryError: unable to create native thread: possibly out of memory or process/resource limits reached
	```

**서초(210.219.174.144) SMS SK 센더(S_S_SK07, S_S_SK08, S_S_SK09, S_S_SK10)** 가 OOM 이 발생하여 인입된 메세지 처리를 하지 못하고 있음에도 불구하고 센더 매니저가 이를 감지하지 못하고 장애 상황 지속되었음

--- 

# 장애 조치 

**서초 SMS SK 센더(S_S_SK07, S_S_SK08, S_S_SK09, S_S_SK10)** 에 한하여 프로세스 `stop.sh` 스크립트 실행하여 종료 시도하였으나 아래와 같이 프로세스 정상 종료되지 않고 살아있는 현상 발경하였음

- `stop.sh` 스크립트 실행하였으나 종료되지 않은 프로세스
	![[정상 종료되지 않은 프로세스 이미지.png]]

정상 종료되지 않은 프로세스 `kill -9 ${PID}` 명령어로 강제 종료한 후 `start.sh` 스크립트 실행하여 해당 프로세스 재기동 조치하였으며 큐에 적재되어있던 SMS 메세지건 정상 발송 처리된 것 확인하였음.

---

# 해당 케이스 장애 해결 방안

- 장애 발생 원인 파악 및 해결 방안
	1. **서초(210.219.174.144) 서버 메모리 자원 부족**으로 인한 **OOM 발생**하여 센더의 **RabbitMQ Consumer 가 죽는 현상이 발생**
	2. OOM 발생하였음에도 불구하고 센더 매니저에게 전송하는 **Heart 패킷의 상태 값을 0 으로 전송**하여 **장애 감지 X**
	3. **기존 장애 감지 로직**은 **OOM 과 같은 예외 발생 시 센더매니저에게 장애 상황 전파 부분에 미흡한 부분이 존재**하는 것으로 보여 *RabbitMQ Consumer 의 존재 여부를 판단하는 등의 로직을 추가하여 장애 전파 가능하도록 로직 수정 필요*한 것으로 보임

- 기타 확인 필요 사항
	1. `stop.sh` 스크립트로 **프로세스 정상 종료되지 않는 문제 확인 필요**

